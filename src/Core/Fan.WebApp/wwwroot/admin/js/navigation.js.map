{"version":3,"sources":["../../../Manage/Admin/client/js/navigation.js"],"names":["Vue","component","mixins","navigationMixin","data","dialogVisible","dialogTitle","settingsUrl","infoPanels","custLinkValid","custLinkUrl","custLinkText","rules","required","value","url","infoOptions","group","name","pull","put","sort","menuOptions","ghostClass","mounted","initSettingsUpdatedHandler","methods","add","evt","im","fromId","from","id","menuId","to","index","newIndex","oldIndex","nav","pages","type","text","apps","cats","menu","menus","find","m","toString","navs","title","origNavName","console","log","resp","axios","post","$root","headers","e","error","toastError","deleteNav","confirm","delete","splice","addCustLink","selectedMenuId","length","push","setHome","home","toast","viewSettings","closeDialog","self","window","document","addEventListener","detail","msg"],"mappings":"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","sourcesContent":["ï»¿Vue.component('navigation', {\r\n    mixins: [navigationMixin],\r\n    data: () => ({\r\n        dialogVisible: false,\r\n        dialogTitle: '',\r\n        settingsUrl: null,\r\n        infoPanels: [true, false, false, false],\r\n        custLinkValid: false,\r\n        custLinkUrl: '',\r\n        custLinkText: '',\r\n        rules: {\r\n            required: value => !!value || 'Required.', // value.trim() conflicts with form.reset\r\n            url: value => {\r\n                //const pattern = 'TODO url regex that includes root /'\r\n                //return pattern.test(value) || 'Invalid URL.'\r\n                return true;\r\n            }\r\n        },\r\n        infoOptions: {\r\n            group: { name: 'navs', pull: 'clone', put: false },\r\n            sort: false\r\n        },\r\n        menuOptions: {\r\n            group: 'navs',\r\n            ghostClass: 'sortable-ghost'\r\n        }\r\n    }),\r\n    mounted() {\r\n        this.initSettingsUpdatedHandler();\r\n    },\r\n    methods: {\r\n        async add(evt) {\r\n            let im = {\r\n                fromId: evt.from.id,\r\n                menuId: evt.to.id,\r\n                index: evt.newIndex,\r\n                oldIndex: evt.oldIndex,\r\n            };\r\n\r\n            if (evt.from.id === 'page-navs') {\r\n                let nav = this.pages[evt.oldIndex];\r\n                im.id = nav.id;\r\n                im.type = nav.type;\r\n                im.text = nav.text;\r\n            }\r\n            else if (evt.from.id === 'app-navs') {\r\n                let nav = this.apps[evt.oldIndex];\r\n                im.id = nav.id;\r\n                im.type = nav.type;\r\n                im.text = nav.text;\r\n            }\r\n            else if (evt.from.id === 'cat-navs') {\r\n                let nav = this.cats[evt.oldIndex];\r\n                im.id = nav.id;\r\n                im.type = nav.type;\r\n                im.text = nav.text;\r\n            }\r\n            else { // from another menu\r\n                // since the nav is dragged to the new menu, use to.id\r\n                let menu = this.menus.find(m => m.id.toString() === evt.to.id);\r\n                let nav = menu.navs[evt.newIndex];\r\n                im.id = nav.id;\r\n                im.type = nav.type;\r\n                im.text = nav.text;\r\n                im.title = nav.title;\r\n                im.url = nav.url;\r\n                im.origNavName = nav.origNavName;\r\n            }\r\n\r\n            console.log('Nav being added: ', im);\r\n\r\n            try {\r\n                let resp = await axios.post('/admin/navigation?handler=add', im, this.$root.headers);\r\n                let menu = this.menus.find(m => m.id.toString() === evt.to.id);\r\n                let nav = menu.navs[evt.newIndex];\r\n                nav.settingsUrl = resp.data.settingsUrl;\r\n                nav.origNavName = im.origNavName;\r\n            } catch (e) {\r\n                console.error(e);\r\n                this.$root.toastError('Add menu item failed.');\r\n            }\r\n        },\r\n        async sort(evt) {\r\n            if (evt.from.id !== evt.to.id) return;\r\n\r\n            try {\r\n                let im = {\r\n                    menuId: evt.to.id,\r\n                    index: evt.newIndex,\r\n                    oldIndex: evt.oldIndex,\r\n                };\r\n\r\n                console.log('sort: ', im);\r\n                await axios.post('/admin/navigation?handler=sort', im, this.$root.headers);\r\n            } catch (e) {\r\n                console.error(e);\r\n                this.$root.toastError('Sort menu item failed.');\r\n            }\r\n        },\r\n        async deleteNav(menuId, index) {\r\n            if (confirm(`Are you sure to delete this menu item?`)) {\r\n                try {\r\n                    await axios.delete(`/admin/navigation?menuId=${menuId}&index=${index}`, this.$root.headers);\r\n                    let menu = this.menus.find(m => m.id === menuId);\r\n                    menu.navs.splice(index, 1);\r\n                } catch (e) {\r\n                    console.error(e);\r\n                    this.$root.toastError('Delete menu item failed.');\r\n                }\r\n            }\r\n        },\r\n        async addCustLink() {\r\n            try {\r\n                console.log('custLinkUrl: ', this.custLinkUrl);\r\n                console.log('custLinkText: ', this.custLinkText);\r\n                console.log('selectedMenuId', this.selectedMenuId);\r\n                console.log('menu', this.menus.find(m => m.id === this.selectedMenuId).navs);\r\n\r\n                let nav = {\r\n                    url: this.custLinkUrl,\r\n                    text: this.custLinkText,\r\n                    menuId: this.selectedMenuId,\r\n                    index: this.menus.find(m => m.id === this.selectedMenuId).navs.length,\r\n                };\r\n\r\n                let resp = await axios.post('/admin/navigation?handler=customLink', nav, this.$root.headers);\r\n                console.log(resp.data);\r\n                nav.settingsUrl = resp.data.settingsUrl;\r\n                nav.type = resp.data.type;\r\n                this.menus.find(m => m.id === this.selectedMenuId).navs.push(nav);\r\n\r\n                // reset form unfortunately clears v-select, need to figure out how to avoid\r\n                //this.$refs.custLinkForm.reset();\r\n                //console.log('selectedMenuId', this.selectedMenuId);\r\n                //this.selectedMenuId = 1; // reset the select\r\n            } catch (e) {\r\n                console.error(e);\r\n                this.$root.toastError('Add menu item failed.');\r\n            }\r\n        },\r\n        async setHome(nav) {\r\n            try {\r\n                console.log('Set nav as home: ', nav);\r\n                await axios.post(`/admin/navigation?handler=home`, nav, this.$root.headers);\r\n                this.home = nav;\r\n                this.$root.toast('Home updated.');\r\n            } catch (e) {\r\n                console.error(e);\r\n                this.$root.toastError('Set as home failed.');\r\n            }\r\n        },\r\n        viewSettings(nav) {\r\n            console.log(nav);\r\n            this.dialogTitle = nav.text;\r\n            this.dialogVisible = true;\r\n            this.settingsUrl = nav.settingsUrl;\r\n        },\r\n        closeDialog() {\r\n            this.dialogVisible = false;\r\n        },\r\n        initSettingsUpdatedHandler() {\r\n            let self = this;\r\n            window.document.addEventListener('ExtSettingsUpdated', e => {\r\n                console.log('nav settings updated: ', e.detail);\r\n\r\n                // update the menu nav text\r\n                let menu = this.menus.find(m => m.id === e.detail.menuId);\r\n                let nav = menu.navs[e.detail.index];\r\n                nav.text = e.detail.text;\r\n\r\n                // show toast and close dialog\r\n                self.$root.toast(e.detail.msg);\r\n                self.closeDialog();\r\n            });\r\n        },\r\n    }\r\n});\r\n"],"file":"navigation.js"}