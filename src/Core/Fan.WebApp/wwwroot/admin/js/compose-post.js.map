{"version":3,"sources":["../../../Manage/Admin/client/js/compose-post.js"],"names":["app","Vue","el","store","mixins","composeMixin","data","pubClicked","pubText","saveVisible","saveDisabled","saveText","closing","fieldChanged","drawer","panel","menuDate","mediaDialogVisible","previewUrl","postUrl","previewDialogVisible","editor","snackbar","show","text","color","composerUploadProgress","computed","disablePubButton","post","title","trim","length","tok","document","querySelector","value","headers","payload","id","postDate","categoryId","tags","slug","excerpt","body","getData","selectedImages","$store","state","mounted","published","initWindowDnd","initEditor","methods","window","addEventListener","style","visibility","opacity","e","preventDefault","self","dragFilesUpload","dataTransfer","files","formData","FormData","Array","from","keys","map","x","append","sendImages","axios","$root","then","resp","images","insertImagesToEditor","toast","toastError","dispatch","catch","typingTimer","ClassicEditor","create","autosave","save","clearTimeout","setTimeout","saveDraft","autosaveInterval","onFieldsChange","draftDate","isDraft","location","href","endsWith","history","replaceState","preview","replace","closePreview","revert","pub","url","insertImages","imgsHtml","forEach","img","urlMedium","alt","caption","selected","viewFragment","processor","toView","modelFragment","toModel","model","insertContent","selection","closeMediaDialog","titleEnter"],"mappings":"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","sourcesContent":["ï»¿let app = new Vue({\r\n    el: '#app',\r\n    store,\r\n    mixins: [composeMixin],\r\n    data: () => ({\r\n        pubClicked: false,\r\n        pubText: '',\r\n        saveVisible: false,\r\n        saveDisabled: false,\r\n        saveText: 'Save',\r\n        closing: true,\r\n        fieldChanged: false,\r\n        drawer: null,\r\n        panel: [true, true, true],\r\n        menuDate: false,\r\n        mediaDialogVisible: false,\r\n        previewUrl: null,\r\n        postUrl: null,\r\n        previewDialogVisible: false,\r\n        editor: null,\r\n        snackbar: {\r\n            show: false,\r\n            text: '',\r\n            color: '',\r\n        },\r\n        composerUploadProgress: false,\r\n    }),\r\n    computed: {\r\n        disablePubButton() {\r\n            return this.post.title.trim().length <= 0 || this.pubClicked;\r\n        },\r\n        tok: function () {\r\n            return document.querySelector('input[name=\"__RequestVerificationToken\"][type=\"hidden\"]').value;\r\n        },\r\n        headers() {\r\n            return { headers: { 'XSRF-TOKEN': this.tok } };\r\n        },\r\n        payload: function () {\r\n            return {\r\n                id: this.post.id,\r\n                postDate: this.post.postDate,\r\n                categoryId: this.post.categoryId,\r\n                tags: this.post.tags,\r\n                slug: this.post.slug,\r\n                excerpt: this.post.excerpt,\r\n                title: this.post.title,\r\n                body: this.editor.getData(),\r\n            }\r\n        },\r\n        selectedImages() { // from store\r\n            return this.$store.state.selectedImages;\r\n        },\r\n    },\r\n    mounted() {\r\n        this.pubText = this.post.published ? 'Update' : 'Publish';\r\n        this.initWindowDnd();\r\n        this.initEditor();\r\n    },\r\n    methods: {\r\n        /**\r\n         * Initialize window drag drop events, dragFilesUpload and sendIMages.\r\n         */\r\n        initWindowDnd() {\r\n            console.log('initWindowDnd');\r\n            window.addEventListener(\"dragenter\", function (e) {\r\n                document.querySelector(\"#dropzone\").style.visibility = \"\";\r\n                document.querySelector(\"#dropzone\").style.opacity = 1;\r\n            });\r\n\r\n            window.addEventListener(\"dragleave\", function (e) {\r\n                e.preventDefault();\r\n                document.querySelector(\"#dropzone\").style.visibility = \"hidden\";\r\n                document.querySelector(\"#dropzone\").style.opacity = 0;\r\n            });\r\n\r\n            window.addEventListener(\"dragover\", function (e) {\r\n                e.preventDefault();\r\n                document.querySelector(\"#dropzone\").style.visibility = \"\";\r\n                document.querySelector(\"#dropzone\").style.opacity = 1;\r\n            });\r\n\r\n            let self = this;\r\n            window.addEventListener(\"drop\", function (e) {\r\n                e.preventDefault();\r\n                document.querySelector(\"#dropzone\").style.visibility = \"hidden\";\r\n                document.querySelector(\"#dropzone\").style.opacity = 0;\r\n                if (!self.mediaDialogVisible) self.dragFilesUpload(e.dataTransfer.files); // prevent gallery call this\r\n            });\r\n        },\r\n        dragFilesUpload(files) {\r\n            if (!files.length) return;\r\n            this.composerUploadProgress = true; // open progress\r\n            const formData = new FormData();\r\n            Array.from(Array(files.length).keys()).map(x => formData.append('images', files[x]));\r\n            this.sendImages(formData);\r\n        },\r\n        sendImages(formData) {\r\n            axios.post('/admin/media?handler=image', formData, this.$root.headers)\r\n                .then(resp => {\r\n                    if (resp.data.images.length > 0) {\r\n                        this.insertImagesToEditor(resp.data.images);\r\n                        this.$root.toast('Image uploaded.');\r\n                    }\r\n                    else {\r\n                        this.$root.toastError('Some files were not uploaded due to file type or size not supported.');\r\n                    }\r\n                    this.composerUploadProgress = false; // close progress\r\n                    this.$store.dispatch('emptyErrMsg');\r\n                })\r\n                .catch(err => {\r\n                    this.composerUploadProgress = false; // close progress\r\n                    this.$root.toastError('Image upload failed.');\r\n                    console.log(err);\r\n                });\r\n        },\r\n        initEditor() {\r\n            let typingTimer;\r\n            let self = this;\r\n            ClassicEditor.create(document.querySelector('#editor'), {\r\n                autosave: {\r\n                    save(editor) {\r\n                        clearTimeout(typingTimer);\r\n                        let body = self.editor.getData();\r\n                        if (!self.post.published && body && body.trim().length !== 0) { // save only when there is content\r\n                            self.saveVisible = true;\r\n                            self.saveDisabled = false;\r\n                            self.saveText = 'Save';\r\n                            typingTimer = setTimeout(self.saveDraft, self.autosaveInterval);\r\n                        }\r\n                    }\r\n                }\r\n            })\r\n                .then(editor => {\r\n                    self.editor = editor;\r\n                    console.log('editor initialized: ', self.editor);\r\n                })\r\n                .catch(error => {\r\n                    console.error(error);\r\n                });\r\n        },\r\n        onFieldsChange() {\r\n            this.fieldChanged = true;\r\n            if (this.post.published) return;\r\n            this.saveVisible = true;\r\n            this.saveDisabled = false;\r\n            this.saveText = 'Save';\r\n        },\r\n        saveDraft() {\r\n            console.log('save draft');\r\n            this.saveVisible = true;\r\n            this.saveDisabled = true;\r\n            this.saveText = 'Saving...';\r\n\r\n            console.log('payload: ', this.payload);\r\n            axios.post('/admin/compose/post?handler=save', this.payload, { headers: { 'XSRF-TOKEN': this.tok } })\r\n                .then(resp => {\r\n                    this.post.id = resp.data.id;\r\n                    this.post.slug = resp.data.slug;\r\n                    this.post.draftDate = resp.data.draftDate;\r\n                    this.post.isDraft = true;\r\n                    if (window.location.href.endsWith('/compose/post'))\r\n                        history.replaceState({}, null, window.location.href + `/${this.post.id}`);\r\n                })\r\n                .catch(err => { console.log(err); });\r\n\r\n            this.fieldChanged = false;\r\n            this.saveText = 'Saved';\r\n        },\r\n        preview() {\r\n            this.previewDialogVisible = true;\r\n            this.payload.body = this.editor.getData();\r\n            axios.post('/admin/compose/post?handler=preview', this.payload, { headers: { 'XSRF-TOKEN': this.tok } })\r\n                .then(resp => {\r\n                    this.previewUrl = resp.data;\r\n                    this.postUrl = this.previewUrl.replace('preview/', '');\r\n                })\r\n                .catch(err => { console.log(err); });\r\n        },\r\n        closePreview() {\r\n            this.previewDialogVisible = false;\r\n            this.previewUrl = null;\r\n            this.postUrl = null;\r\n        },\r\n        revert() {\r\n            this.post.published = false;\r\n            this.pubText = this.post.published ? 'Update' : 'Publish';\r\n            this.saveDraft();\r\n        },\r\n        pub() {\r\n            this.closing = false;\r\n            this.pubClicked = true;\r\n            this.pubText = this.post.published ? 'Updating...' : 'Publishing...';\r\n\r\n            const url = this.post.published ? '/admin/compose/post?handler=update' : '/admin/compose/post?handler=publish';\r\n            axios.post(url, this.payload, { headers: { 'XSRF-TOKEN': this.tok } })\r\n                .then(resp => {\r\n                    window.location.replace(resp.data);\r\n                })\r\n                .catch(err => { console.log(err); });\r\n        },\r\n        /**\r\n         * Inserts selected images from gallery to editor.\r\n         */\r\n        insertImages() {\r\n            this.insertImagesToEditor(this.selectedImages);\r\n            this.mediaDialogVisible = false;\r\n            this.$store.dispatch('emptySelectedImages'); // clear selectedImages so gallery buttons could hide\r\n            this.$store.dispatch('emptyErrMsg');\r\n        },\r\n        /**\r\n         * Inserts images to editor.\r\n         * https://docs.ckeditor.com/ckeditor5/latest/builds/guides/faq.html#where-are-the-editorinserthtml-and-editorinserttext-methods-how-to-insert-some-content\r\n         * https://docs.ckeditor.com/ckeditor5/latest/features/image.html#image-captions\r\n         */\r\n        insertImagesToEditor(images) {\r\n            let imgsHtml = '';\r\n            images.forEach(img => {\r\n                imgsHtml += `<figure class=\"image\"><img src=\"${img.urlMedium}\" alt=\"${img.alt}\" title=\"${img.title}\"><figcaption>${img.caption}</figcaption></figure>`;\r\n                img.selected = false; // remove the checkmark\r\n            });\r\n            const viewFragment = this.editor.data.processor.toView(imgsHtml);\r\n            const modelFragment = this.editor.data.toModel(viewFragment);\r\n            this.editor.model.insertContent(modelFragment, this.editor.model.document.selection);\r\n        },\r\n        closeMediaDialog() {\r\n            this.mediaDialogVisible = false;\r\n            this.selectedImages.forEach(img => img.selected = false); // remove checkmarks\r\n            this.$store.dispatch('emptySelectedImages'); // clear selectedImages so gallery buttons could hide\r\n            this.$store.dispatch('emptyErrMsg');\r\n        },\r\n        titleEnter() {\r\n            this.post.title = this.post.title.replace(/\\n/g, ' ');\r\n        },\r\n        toast(text, color = 'silver') {\r\n            this.snackbar.show = true;\r\n            this.snackbar.text = text;\r\n            this.snackbar.color = color;\r\n        },\r\n        toastError(text) {\r\n            this.snackbar.show = true;\r\n            this.snackbar.text = text;\r\n            this.snackbar.color = 'red';\r\n        },\r\n    },\r\n});"],"file":"compose-post.js"}