{"version":3,"sources":["../../../Manage/Admin/client/js/compose-page.js"],"names":["app","Vue","el","store","mixins","composeMixin","editorMdMixin","data","pubClicked","pubText","saveVisible","saveDisabled","saveText","closing","fieldChanged","drawer","panel","menuDate","mediaDialogVisible","previewUrl","postUrl","previewDialogVisible","editor","snackbar","show","text","color","mode","timeout","composerUploadProgress","computed","disablePubButton","page","title","trim","length","tok","document","querySelector","value","headers","payload","id","parentId","postDate","excerpt","pageLayout","selectedImages","$store","state","mounted","published","initWindowDnd","initEditor","methods","window","addEventListener","style","visibility","opacity","e","preventDefault","self","dragFilesUpload","dataTransfer","files","formData","FormData","Array","from","keys","map","x","append","sendImages","axios","post","then","resp","images","insertImagesToEditor","toast","toastError","dispatch","catch","onFieldsChange","saveDraft","body","getPreviewedHTML","bodyMark","getMarkdown","draftDate","isDraft","href","location","includes","endsWith","pos","indexOf","history","replaceState","substring","err","response","preview","replace","closePreview","revert","pub","url","isParentDraft","close","insertImages","imgsHtml","forEach","img","alt","urlOriginal","selected","insertValue","closeMediaDialog","titleEnter"],"mappings":"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","sourcesContent":["ï»¿let app = new Vue({\r\n    el: '#app',\r\n    store,\r\n    mixins: [composeMixin, editorMdMixin], // from plugin\r\n    data: () => ({\r\n        pubClicked: false,\r\n        pubText: '',\r\n        saveVisible: false,\r\n        saveDisabled: false,\r\n        saveText: 'Save',\r\n        closing: true,\r\n        fieldChanged: false,\r\n        drawer: null,\r\n        panel: [true, true, true],\r\n        menuDate: false,\r\n        mediaDialogVisible: false,\r\n        previewUrl: null,\r\n        postUrl: null,\r\n        previewDialogVisible: false,\r\n        editor: null,\r\n        snackbar: {\r\n            show: false,\r\n            text: '',\r\n            color: '',\r\n            mode: '',\r\n            timeout: 10000,\r\n        },\r\n        composerUploadProgress: false,\r\n    }),\r\n    computed: {\r\n        disablePubButton() {\r\n            return this.page.title.trim().length <= 0 || this.pubClicked;\r\n        },\r\n        tok: function () {\r\n            return document.querySelector('input[name=\"__RequestVerificationToken\"][type=\"hidden\"]').value;\r\n        },\r\n        headers() {\r\n            return { headers: { 'XSRF-TOKEN': this.tok } };\r\n        },\r\n        payload: function () {\r\n            return {\r\n                id: this.page.id,\r\n                parentId: this.page.parentId,\r\n                postDate: this.page.postDate,\r\n                title: this.page.title,\r\n                excerpt: this.page.excerpt,\r\n                pageLayout: this.page.pageLayout,\r\n                //bodyMark: this.editor.getMarkdown(),\r\n            }\r\n        },\r\n        selectedImages() { // from store\r\n            return this.$store.state.selectedImages;\r\n        },\r\n    },\r\n    mounted() {\r\n        this.pubText = this.page.published ? 'Update' : 'Publish';\r\n        this.initWindowDnd();\r\n        this.initEditor();\r\n    },\r\n    methods: {\r\n        /**\r\n         * Initialize window drag drop events, dragFilesUpload and sendIMages.\r\n         */\r\n        initWindowDnd() {\r\n            console.log('initWindowDnd');\r\n            window.addEventListener(\"dragenter\", function (e) {\r\n                document.querySelector(\"#dropzone\").style.visibility = \"\";\r\n                document.querySelector(\"#dropzone\").style.opacity = 1;\r\n            });\r\n\r\n            window.addEventListener(\"dragleave\", function (e) {\r\n                e.preventDefault();\r\n                document.querySelector(\"#dropzone\").style.visibility = \"hidden\";\r\n                document.querySelector(\"#dropzone\").style.opacity = 0;\r\n            });\r\n\r\n            window.addEventListener(\"dragover\", function (e) {\r\n                e.preventDefault();\r\n                document.querySelector(\"#dropzone\").style.visibility = \"\";\r\n                document.querySelector(\"#dropzone\").style.opacity = 1;\r\n            });\r\n\r\n            let self = this;\r\n            window.addEventListener(\"drop\", function (e) {\r\n                e.preventDefault();\r\n                document.querySelector(\"#dropzone\").style.visibility = \"hidden\";\r\n                document.querySelector(\"#dropzone\").style.opacity = 0;\r\n                if (!self.mediaDialogVisible) self.dragFilesUpload(e.dataTransfer.files); // prevent gallery call this\r\n            });\r\n        },\r\n        dragFilesUpload(files) {\r\n            if (!files.length) return;\r\n            this.composerUploadProgress = true; // open progress\r\n            const formData = new FormData();\r\n            Array.from(Array(files.length).keys()).map(x => formData.append('images', files[x]));\r\n            this.sendImages(formData);\r\n        },\r\n        sendImages(formData) {\r\n            axios.post('/admin/media?handler=image', formData, { headers: { 'XSRF-TOKEN': this.tok } })\r\n                .then(resp => {\r\n                    if (resp.data.images.length > 0) {\r\n                        this.insertImagesToEditor(resp.data.images);\r\n                        this.toast('Image uploaded.');\r\n                    }\r\n                    else {\r\n                        this.toastError('Some files were not uploaded due to file type or size not supported.');\r\n                    }\r\n                    this.composerUploadProgress = false; // close progress\r\n                    this.$store.dispatch('emptyErrMsg');\r\n                })\r\n                .catch(err => {\r\n                    this.composerUploadProgress = false; // close progress\r\n                    this.toastError('Image upload failed.');\r\n                    console.log(err);\r\n                });\r\n        },\r\n        onFieldsChange() {\r\n            this.fieldChanged = true;\r\n            if (this.page.published) return;\r\n            this.saveVisible = true;\r\n            this.saveDisabled = false;\r\n            this.saveText = 'Save';\r\n        },\r\n        saveDraft() {\r\n            console.log('save draft');\r\n            this.saveVisible = true;\r\n            this.saveDisabled = true;\r\n            this.saveText = 'Saving...';\r\n\r\n            this.payload.body = this.editor.getPreviewedHTML();\r\n            this.payload.bodyMark = this.editor.getMarkdown();\r\n            console.log('payload: ', this.payload);\r\n            axios.post('/admin/compose/page?handler=save', this.payload, { headers: { 'XSRF-TOKEN': this.tok } })\r\n                .then(resp => {\r\n                    this.page.id = resp.data.id;\r\n                    this.page.draftDate = resp.data.draftDate;\r\n                    this.page.isDraft = true;\r\n\r\n                    let href = window.location.href;\r\n                    if (href.includes('/page?') || href.endsWith('/page')) {\r\n                        let pos = href.indexOf('?');\r\n                        if (pos == -1) {\r\n                            history.replaceState({}, null, href + `/${this.page.id}`);\r\n                        }\r\n                        else {\r\n                            history.replaceState({}, null, href.substring(0, pos) + `/${this.page.id}` + href.substring(pos));\r\n                        }\r\n                    }\r\n                })\r\n                .catch(err => {\r\n                    this.saveVisible = false;\r\n                    this.toastError(err.response.data);\r\n                });\r\n\r\n            this.fieldChanged = false;\r\n            this.saveText = 'Saved';\r\n        },\r\n        preview() {\r\n            this.previewDialogVisible = true;\r\n            //this.payload.body = this.editor.getHTML();\r\n            this.payload.body = this.editor.getPreviewedHTML();\r\n            this.payload.bodyMark = this.editor.getMarkdown();\r\n\r\n            axios.post('/admin/compose/page?handler=preview', this.payload, { headers: { 'XSRF-TOKEN': this.tok } })\r\n                .then(resp => {\r\n                    this.previewUrl = resp.data;\r\n                    this.postUrl = this.previewUrl.replace('preview/page/', '');\r\n                })\r\n                .catch(err => { console.log(err); });\r\n        },\r\n        closePreview() {\r\n            this.previewDialogVisible = false;\r\n            this.previewUrl = null;\r\n            this.postUrl = null;\r\n        },\r\n        revert() {\r\n            this.page.published = false;\r\n            this.pubText = this.page.published ? 'Update' : 'Publish';\r\n            this.saveDraft();\r\n        },\r\n        pub() {\r\n            this.closing = false;\r\n            this.pubClicked = true;\r\n            this.pubText = this.page.published ? 'Updating...' : 'Publishing...';\r\n\r\n            const url = this.page.published ? '/admin/compose/page?handler=update' : '/admin/compose/page?handler=publish';\r\n            this.payload.body = this.editor.getPreviewedHTML();\r\n            this.payload.bodyMark = this.editor.getMarkdown();\r\n            axios.post(url, this.payload, { headers: { 'XSRF-TOKEN': this.tok } })\r\n                .then(resp => {\r\n                    if (this.page.isParentDraft)\r\n                        this.close();\r\n                    else\r\n                        window.location.replace(resp.data);\r\n                })\r\n                .catch(err => {\r\n                    this.saveVisible = false;\r\n                    this.pubText = this.page.published ? 'Update' : 'Publish';\r\n                    this.pubClicked = false;\r\n                    this.toastError(err.response.data);\r\n                });\r\n        },\r\n        close() {\r\n            if (this.page.parentId && this.page.parentId > 0)\r\n                window.location.replace(`/admin/pages/${this.page.parentId}`);\r\n            else\r\n                window.location.replace('/admin/pages');\r\n        },\r\n        /**\r\n         * Inserts selected images from gallery to editor.\r\n         */\r\n        insertImages() {\r\n            this.insertImagesToEditor(this.selectedImages);\r\n            this.mediaDialogVisible = false;\r\n            this.$store.dispatch('emptySelectedImages'); // clear selectedImages so gallery buttons could hide\r\n            this.$store.dispatch('emptyErrMsg');\r\n        },\r\n        /**\r\n         * Inserts images to editor.\r\n         */\r\n        insertImagesToEditor(images) {\r\n            let imgsHtml = '';\r\n            images.forEach(img => {\r\n                imgsHtml += `![${img.alt}](${img.urlOriginal} \"${img.title}\")\\n`;\r\n                img.selected = false; // remove the checkmark\r\n            });\r\n            this.editor.insertValue(imgsHtml);\r\n        },\r\n        closeMediaDialog() {\r\n            this.mediaDialogVisible = false;\r\n            this.selectedImages.forEach(img => img.selected = false); // remove checkmarks\r\n            this.$store.dispatch('emptySelectedImages'); // clear selectedImages so gallery buttons could hide\r\n            this.$store.dispatch('emptyErrMsg');\r\n        },\r\n        titleEnter() {\r\n            this.page.title = this.page.title.replace(/\\n/g, ' ');\r\n        },\r\n        toast(text, color = 'silver') {\r\n            this.snackbar.show = true;\r\n            this.snackbar.text = text;\r\n            this.snackbar.color = color;\r\n            this.snackbar.mode = '';\r\n            this.snackbar.timeout = 3000;\r\n        },\r\n        toastError(text) {\r\n            this.snackbar.show = true;\r\n            this.snackbar.text = text;\r\n            this.snackbar.color = 'red';\r\n            this.snackbar.timeout = 10000;\r\n            this.snackbar.mode = 'multi-line';\r\n        },\r\n    },\r\n});\r\n"],"file":"compose-page.js"}